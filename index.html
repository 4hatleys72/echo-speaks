<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Echo Speak Text Entry</title>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.8/css/mdb.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/theme/material.min.css" rel="stylesheet">

    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/mode/simple.min.js"></script>
    <style>
        form div {
            margin-bottom: 0.5em;
            margin: 0 auto;
        }
        
        .form-control {
            font-size: 0.7rem;
        }
        
        button.btn.btn-info.btn-block.my-4 {
            max-width: 200px;
            text-align: center;
        }
        
        .dark-gray {
            background-color: slategray;
        }
        
        .btn-rounded {
            border-radius: 50px !important;
        }
        
        form div label,
        form div input {
            display: block;
            margin-bottom: 0.3em;
        }
    </style>
    <script>
        let inName = 'trig_contact_txt';
        let actId = '26a2ccdc-f404-4e8c-9314-8fe4b5cb009b'
        let rootUrl = 'https://graph.api.smartthings.com:443/api/smartapps/installations/533e121a-d7ba-4ac6-8102-575015956169/textEntryPage/26a2ccdc-f404-4e8c-9314-8fe4b5cb009b/trig_contact_txt?access_token=66965441-ea43-4397-b648-565981895013';
        let curText = '%name% %type% is %value%; The %name% %type% is now %value%;%name% %type% changed to %value%';
        let curTitle = 'Trigger: (Contact) | Event Text';
        let curDesc = 'Add custom responses for the Contact events.<br>To allow multiple random responses just add a response on each line.';
    </script>
</head>

<body>
    <!-- Settings Form -->
    <div style="margin: 0 auto; max-width: 80%;">
        <form class="p-5">
            <p id="inputTitle" class="h4 mb-2 text-center">Text Field Entry</p>
            <textarea id="editor"></textarea>
            <p class="mb-0">Description:</p>
            <small id="inputDesc">Description goes here.</small>

            <div id="submitBtnDiv" class="text-center">
                <button class="btn btn-info btn-rounded my-2" type="submit"><i class="fa fa-save mr-1"></i>Submit</button>
            </div>
        </form>
    </div>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.8/js/mdb.min.js"></script>
    <script>
        toastr.options = {
            "closeButton": false,
            "debug": false,
            "newestOnTop": false,
            "progressBar": false,
            "positionClass": "toast-bottom-center",
            "preventDuplicates": true,
            "onclick": null,
            "showDuration": 300,
            "hideDuration": 1000,
            "timeOut": 5000,
            "extendedTimeOut": 1000,
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }
        $(document).ready(function() {
            $('#inputTitle').text(curTitle);
            $('#inputDesc').html(curDesc);
            $('#editor').val(txtClean(curText));
            CodeMirror.defineSimpleMode("simplemode", {
                start: [{
                    regex: /%[a-z]+%/,
                    token: "variable"
                }]
            });
            var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
                theme: 'material',
                mode: 'simplemode',
                lineNumbers: true,
                lineSeparator: ';',
                lineWrapping: false,
                autocorrect: false,
                autocapitalize: false,
                spellcheck: true
            });

            $('form').submit(function(e) {
                console.log('form submit...')
                e.preventDefault();
                let xmlhttp = new XMLHttpRequest();
                xmlhttp.open("POST", rootUrl);
                xmlhttp.onreadystatechange = () => {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        // console.log(xmlhttp.responseText);
                        toastr.success('Success!', "Text Submitted...")
                    }
                }
                xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                console.log($('#editor').val());
                xmlhttp.send(JSON.stringify({
                    value: $('#editor').val(),
                    name: inName
                }));
            });
        });

        function txtClean(txt) {
            return txt.split(';').map(t => t.trim()).join(';')
        }
    </script>
</body>

</html>